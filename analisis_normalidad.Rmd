---
title: "Análisis de Normalidad"
author: "Paúl Arévalo, Esteban Vizhñay"
date: "2024-07-03"
output: 
  pdf_document:
    extra_dependencies: ["fvextra"]
    includes:
      in_header: header.tex
---

El análisis de normalidad define si una distribución de frecuencias relativas de una variable cuantitativa en una población se aproxima a una Distribución Normal con la misma media y desviación estándar que la variable.

# Métodos Gráficos

Para estas demostraciones se creará una distribución aleatoria:

```{r}
set.seed(12345)
x <- rnorm(n = 200, mean = 15, sd = 5)
x
```

## Histograma de frencuencias

```{r}
h <- hist(x, main = "Histograma de datos con distribución normal", xlab = "Datos aleatorios", ylab = "Frecuencia", probability = TRUE)
x2 <- seq(min(x), max(x), length = 50)
normal <- dnorm(x2, mean = mean(x), sd = sd(x))
lines(x2, normal, col = 2, lwd = 2)
lines(density(x), col = 4, lwd = 2)
```

## Gráfico de cuantiles teóricos (Gráfico Q-Q)

```{r}
qqnorm(x, main = "Gráfico Q-Q Normal", xlab = "Cuantiles Teóricos", ylab = "Cuantiles de muestra", pch = 20, col = "blue")
qqline(x)
```

## Diagrama de Caja

```{r}
boxplot(x)
```

# Métodos Analíticos

## Asimetría

Existen tres tipos de asimetría

![Comparativa de Normalidad](/home/paul/Development/ciencia_datos/FundamentosCienciaDatos/TrabajoAnalisisNormalidad/norm.png){width="635"}

Para el analisis del mismo vamos a definir los siguientes rangos:

-   El valor se encuentra entre -0.5 y 0.5. La distribución es aproximadamente sesgada.

-   El valor se encuentra entre -1 a -5 o 1 a 5. La distribución es ligeramente sesgada.

-   El valor es menor que -1 o mayor a 1. La distribución es moderadamente sesgada pero aceptable.

-   Si el valor supera -2 o 2. La distribución no es normal

```{r}
dist_norm_as <- rnorm(n = 450, mean = 2, sd = 2.3)
dist_gamma_as <- rgamma(n = 450, shape = 2, scale = 3)
```

```{r}
# Configurar la disposición de los gráficos
par(mfrow = c(1, 2))

# Dibujar el primer histograma
hist(dist_norm_as, main = "Normal", col = "blue")

# Dibujar el segundo histograma
hist(dist_gamma_as, main = "Gamma", col = "red")
```

```{r}
library(moments)

print(skewness(dist_norm_as))
print(skewness(dist_gamma_as))
```

## Curtosis

Permite medir el grado de apuntamiento o achatamiento de la distribución de frecuencia, respecto a la curva de la distribución normal que tiene coeficiente igual a 0.

![](/home/paul/Development/ciencia_datos/FundamentosCienciaDatos/TrabajoAnalisisNormalidad/norm1.jpeg)

```{r}
print(kurtosis(dist_norm_as))
print(kurtosis(dist_gamma_as))
```
```{r}
library("nortest")
library(moments)
```

# Contraste de hipótesis


En todas las pruebas a realizar se considera como hipótesis nula que los datos sí proceden de una distribución normal y como hipótesis alternativa que no lo hacen. El *p-value* de estos test indica la probabilidad de obtener una distribución como la observada si los datos proceden realmente de una población con una distribución normal.

***El nivel de significancia es 0.05***

## Prueba de Shapiro-Wilk

La muestra debe ser menor a 50 datos.

```{r}
dist_norm_sw <- rnorm(n = 49, mean = 15, sd = 5)
dist_binm_sw <- rnbinom(n = 49, size = 5, prob = 0.35)

# calculamos la curva de normalidad
dist_norm_sw_x <- seq(min(dist_norm_sw), max(dist_norm_sw), length = 49)
dist_norm_sw_x_normal <- dnorm(dist_norm_sw_x, mean = mean(dist_norm_sw_x), sd = sd(dist_norm_sw_x))
dist_norm_sw_asi <- skewness(dist_norm_sw)
dist_norm_sw_cur <- kurtosis(dist_norm_sw)

dist_binm_sw_x <- seq(min(dist_binm_sw), max(dist_binm_sw), length = 49)
dist_binm_sw_x_normal <- dnorm(dist_binm_sw_x, mean = mean(dist_binm_sw_x), sd = sd(dist_binm_sw_x))
dist_binm_sw_asi <- skewness(dist_binm_sw)
dist_binm_sw_cur <- kurtosis(dist_binm_sw)
```


```{r}
# Configurar la disposición de los gráficos
# par(mfrow = c(1, 2))

# Dibujar el primer histograma
hist(dist_norm_sw, main = "Normal", col = "blue", probability = TRUE)
lines(dist_norm_sw_x, dist_norm_sw_x_normal, col = "red", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_norm_sw), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_norm_sw_asi, 2), "\nCurtosis:", round(dist_norm_sw_cur, 2)), col = "black")

#lines(density(dist_norm_sw_x), col = "green", lwd = 2)

```

```{r}

# Dibujar el segundo histograma
hist(dist_binm_sw, main = "Binomial", col = "red", probability = TRUE)
lines(dist_binm_sw_x, dist_binm_sw_x_normal, col = "blue", lwd = 2)
#lines(density(dist_binm_sw_x), col = "green", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_binm_sw), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_binm_sw_asi, 2), "\nCurtosis:", round(dist_binm_sw_cur, 2)), col = "black")
```

```{r}
print(shapiro.test(x = dist_norm_sw))
print(shapiro.test(x = dist_binm_sw))
```


## Prueba de Anderson-Darling

El número de muestras tiene que ser mayor a 7


```{r}
dist_norm_ad <- rnorm(n = 85, mean = 15, sd = 5)
dist_binm_ad <- rnbinom(n = 76, size = 5, prob = 0.35)

# calculamos la curva de normalidad
dist_norm_ad_x <- seq(min(dist_norm_ad), max(dist_norm_ad), length = 85)
dist_norm_ad_x_normal <- dnorm(dist_norm_ad_x, mean = mean(dist_norm_ad_x), sd = sd(dist_norm_ad_x))
dist_norm_ad_asi <- skewness(dist_norm_ad)
dist_norm_ad_cur <- kurtosis(dist_norm_ad)

dist_binm_ad_x <- seq(min(dist_binm_ad), max(dist_binm_ad), length = 76)
dist_binm_ad_x_normal <- dnorm(dist_binm_ad_x, mean = mean(dist_binm_ad_x), sd = sd(dist_binm_ad_x))
dist_binm_ad_asi <- skewness(dist_binm_ad)
dist_binm_ad_cur <- kurtosis(dist_binm_ad)

```


```{r}
# Configurar la disposición de los gráficos
#par(mfrow = c(1, 2))

# Dibujar el primer histograma
hist(dist_norm_ad, main = "Normal", col = "blue", probability = TRUE)
lines(dist_norm_ad_x, dist_norm_ad_x_normal, col = "red", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_norm_ad), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_norm_ad_asi, 2), "\nCurtosis:", round(dist_norm_ad_cur, 2)), col = "black")

```

```{r}
# Dibujar el segundo histograma
hist(dist_binm_ad, main = "Binomial", col = "red", probability = TRUE)
lines(dist_binm_ad_x, dist_binm_ad_x_normal, col = "blue", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_binm_ad), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_binm_ad_asi, 2), "\nCurtosis:", round(dist_binm_ad_cur, 2)), col = "black")
```


```{r}
print(ad.test(x = dist_norm_ad))
print(ad.test(x = dist_binm_ad))
```



## Prueba de Cramer-von Mises

Útil para muestras pequeñas



```{r}
dist_norm_cm <- rnorm(n = 49, mean = 15, sd = 5)
dist_gamm_cm <- rgamma(n = 49, shape = 2, scale = 3)

# calculamos la curva de normalidad
dist_norm_cm_x <- seq(min(dist_norm_cm), max(dist_norm_cm), length = 49)
dist_norm_cm_x_normal <- dnorm(dist_norm_cm_x, mean = mean(dist_norm_cm_x), sd = sd(dist_norm_cm_x))
dist_norm_cm_asi <- skewness(dist_norm_cm)
dist_norm_cm_cur <- kurtosis(dist_norm_cm)

dist_gamm_cm_x <- seq(min(dist_gamm_cm), max(dist_gamm_cm), length = 49)
dist_gamm_cm_x_normal <- dnorm(dist_gamm_cm_x, mean = mean(dist_gamm_cm_x), sd = sd(dist_gamm_cm_x))
dist_gamm_cm_asi <- skewness(dist_gamm_cm)
dist_gamm_cm_cur <- kurtosis(dist_gamm_cm)
```


```{r}
# Configurar la disposición de los gráficos
# par(mfrow = c(1, 2))

# Dibujar el primer histograma
hist(dist_norm_cm, main = "Normal", col = "blue", probability = TRUE)
lines(dist_norm_cm_x, dist_norm_cm_x_normal, col = "red", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_norm_cm), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_norm_cm_asi, 2), "\nCurtosis:", round(dist_norm_cm_cur, 2)), col = "black")

```


```{r}
# Dibujar el segundo histograma
hist(dist_gamm_cm, main = "Gamma", col = "red", probability = TRUE)
lines(dist_gamm_cm_x, dist_gamm_cm_x_normal, col = "blue", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_gamm_cm), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_gamm_cm_asi, 2), "\nCurtosis:", round(dist_gamm_cm_cur, 2)), col = "black")
```


```{r}
print(cvm.test(x = dist_norm_cm))
print(cvm.test(x = dist_gamm_cm))
```



## Prueba Lilliefors

Número de observaciones mayor a 50

```{r}
dist_norm_li <- rnorm(n = 320, mean = 15, sd = 5)
dist_gamm_li <- rgamma(n = 320, shape = 2, scale = 3)


# calculamos la curva de normalidad
dist_norm_li_x <- seq(min(dist_norm_li), max(dist_norm_li), length = 320)
dist_norm_li_x_normal <- dnorm(dist_norm_li_x, mean = mean(dist_norm_li_x), sd = sd(dist_norm_li_x))
dist_norm_li_asi <- skewness(dist_norm_li)
dist_norm_li_cur <- kurtosis(dist_norm_li)

dist_gamm_li_x <- seq(min(dist_gamm_li), max(dist_gamm_li), length = 320)
dist_gamm_li_x_normal <- dnorm(dist_gamm_li_x, mean = mean(dist_gamm_li_x), sd = sd(dist_gamm_li_x))
dist_gamm_li_asi <- skewness(dist_gamm_li)
dist_gamm_li_cur <- kurtosis(dist_gamm_li)
```


```{r}
hist(dist_norm_li, main = "Normal", col = "blue", probability = TRUE)
lines(dist_norm_li_x, dist_norm_li_x_normal, col = "red", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_norm_li), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_norm_li_asi, 2), "\nCurtosis:", round(dist_norm_li_cur, 2)), col = "black")
```


```{r}
# Dibujar el segundo histograma
hist(dist_gamm_li, main = "Gamma", col = "red", probability = TRUE)
lines(dist_gamm_li_x, dist_gamm_li_x_normal, col = "blue", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_gamm_li), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_gamm_li_asi, 2), "\nCurtosis:", round(dist_gamm_li_cur, 2)), col = "black")
```


```{r}
print(lillie.test(x = dist_norm_li))
print(lillie.test(x = dist_gamm_li))
```



## Prueba Pearson chi-square

Basa en una distribución Chi Cuadrada



```{r}
dist_norm_pcq <- rnorm(n = 410, mean = 15, sd = 5)
dist_gamm_pcq <- rgamma(n = 410, shape = 2, scale = 3)

# calculamos la curva de normalidad
dist_norm_pcq_x <- seq(min(dist_norm_pcq), max(dist_norm_pcq), length = 320)
dist_norm_pcq_x_normal <- dnorm(dist_norm_pcq_x, mean = mean(dist_norm_pcq_x), sd = sd(dist_norm_pcq_x))
dist_norm_pcq_asi <- skewness(dist_norm_pcq)
dist_norm_pcq_cur <- kurtosis(dist_norm_pcq)

dist_gamm_pcq_x <- seq(min(dist_gamm_pcq), max(dist_gamm_pcq), length = 320)
dist_gamm_pcq_x_normal <- dnorm(dist_gamm_pcq_x, mean = mean(dist_gamm_pcq_x), sd = sd(dist_gamm_pcq_x))
dist_gamm_pcq_asi <- skewness(dist_gamm_pcq)
dist_gamm_pcq_cur <- kurtosis(dist_gamm_pcq)

```



```{r}
hist(dist_norm_pcq, main = "Normal", col = "blue", probability = TRUE)
lines(dist_norm_pcq_x, dist_norm_pcq_x_normal, col = "red", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_norm_pcq), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_norm_pcq_asi, 2), "\nCurtosis:", round(dist_norm_pcq_cur, 2)), col = "black")
```


```{r}
# Dibujar el segundo histograma
hist(dist_gamm_pcq, main = "Gamma", col = "red", probability = TRUE)
lines(dist_gamm_pcq_x, dist_gamm_pcq_x_normal, col = "blue", lwd = 2)
# Agregar texto con asimetría y curtosis en la parte superior derecha
text(x = 0.95 * max(dist_gamm_pcq), y = 0.95 * par("usr")[4], pos = 1, adj = c(1, 0),
     labels = paste("Asimetría:", round(dist_gamm_pcq_asi, 2), "\nCurtosis:", round(dist_gamm_pcq_cur, 2)), col = "black")
```



```{r}
print(pearson.test(x = dist_norm_pcq))
print(pearson.test(x = dist_gamm_pcq))
```



